# laravel-react

## フロントエンド

このプロジェクトのフロントエンドは、React と TypeScript を使用して構築されています。主要なディレクトリ構成は以下の通りです：

### ディレクトリ構成

- `src/resources/ts/` - TypeScriptのソースコード
  - `main.tsx` - アプリケーションのエントリーポイント
  - `app.tsx` - メインのアプリケーションコンポーネント
  - `components/` - 再利用可能なUIコンポーネント
    - `ui/` - 基本的なUIコンポーネント
    - `form/` - フォーム関連のコンポーネント
    - `errors/` - エラー表示用コンポーネント
  - `features/` - 機能ごとのコンポーネントとロジック
    - `admin/` - 管理機能関連のコード
      - `api/` - 管理機能用のAPI通信関連コード（例：認証ユーザー情報取得）
      - `hooks/` - 管理機能用のReactカスタムフック（例：認証状態管理用のuseAuth）
      - `types/` - 管理機能用の型定義（例：ユーザー型）
      - `auth/` - 認証関連の機能
        - `api/` - 認証API通信
        - `hooks/` - 認証用カスタムフック
        - `components/` - 認証用コンポーネント（ログインフォームなど）
        - `schema/` - バリデーションスキーマ
      - `store/` - 状態管理（Zustandを使用した認証状態管理など）
  - `routes/` - ルーティング設定
    - `__root.tsx` - ルートルート設定（アプリケーション全体のレイアウトやエラーハンドリング）
    - `index.tsx` - トップページのルート設定
    - `admin/` - 管理画面関連のルート
      - `_authenticated/` - 認証済みユーザー用のルート
        - `route.tsx` - 認証チェックとレイアウト設定
        - `index.tsx` - 管理画面トップページ
      - `_guest/` - 未認証のルート
        - `route.tsx` - 認証ページ共通の設定（未ログインチェックなど）
        - `login.tsx` - ログインページ
        - `register.tsx` - 登録ページ
  - `routeTree.gen.ts` - TanStack Routerによって自動生成されたルートツリー
  - `lib/` - ユーティリティライブラリ
  - `types/` - TypeScript型定義
  - `constants/` - 定数定義
  - `utils/` - ユーティリティ関数
  - `assets/` - 静的アセット

### features ディレクトリの用途

`features` ディレクトリは、アプリケーションの機能ごとにコードを整理するための場所です。各機能は独自のディレクトリを持ち、その中に関連するすべてのコンポーネント、ロジック、API通信、型定義などが含まれています。この構造は「機能ベース」または「ドメイン駆動」のアーキテクチャに基づいており、以下のような利点があります：

- **関心の分離**: 各機能は独立しており、他の機能への依存を最小限に抑えることができます
- **コードの発見可能性**: 特定の機能に関連するすべてのコードが一箇所にまとまっているため、開発者が必要なコードを見つけやすくなります
- **保守性の向上**: 機能ごとに分離されているため、特定の機能の変更が他の機能に影響を与えにくくなります

現在実装されている主な機能：

- **admin**: 管理者向け機能
  - **認証機能**: ログイン/ログアウト処理、認証状態の管理
    - `useAuth` フックを使用して認証状態を管理
    - Zustandを使用した認証ユーザー情報の状態管理
    - TanStack Queryを使用したAPI通信と認証データのキャッシュ

各機能ディレクトリは通常、以下のサブディレクトリを含みます：

- **api/**: 機能に関連するAPIリクエスト関数
- **hooks/**: 機能に関連するReactカスタムフック
- **components/**: 機能に固有のUIコンポーネント
- **types/**: 機能に関連する型定義
- **store/**: 機能に関連する状態管理（Zustandストアなど）
- **schema/**: バリデーションスキーマ（Zodなど）

### routes ディレクトリとTanStack Routerのファイルベースルーティング

このプロジェクトでは、TanStack Router（旧React Router）を使用してルーティングを管理しています。TanStack Routerは、ファイルベースのルーティングシステムを採用しており、ファイル構造がそのままURLパスに反映されます。

#### ファイルベースルーティングの仕組み

1. **ファイル構造とURL**: `routes` ディレクトリ内のファイル構造がそのままURLパスに変換されます
   - 例: `routes/dashboard.tsx` → `/dashboard`

2. **特殊なファイル名規則**:
   - `__root.tsx`: アプリケーション全体のルートレイアウトを定義
   - `index.tsx`: ディレクトリのインデックスルート（例: `/index.tsx` → `/`）
   - `_authenticated/`: アンダースコアで始まるディレクトリは「レイアウトルート」として機能し、URLパスには含まれない

3. **ルートファイルの構造**:
   - 各ルートファイルでは `createFileRoute` 関数を使用してルートを定義
   - `component`: ルートのコンポーネント
   - `beforeLoad`: ルートがロードされる前に実行される処理（認証チェックなど）
   - `loader`: データの事前読み込み
   - `errorComponent`: エラー発生時に表示するコンポーネント

4. **自動生成されるルートツリー**:
   - TanStack Routerは `routeTree.gen.ts` ファイルを自動生成
   - このファイルには、すべてのルートの型情報と関係性が含まれる

#### 認証とルーティング

このプロジェクトでは、ルーティングと認証を組み合わせて以下のような機能を実現しています：

1. **認証状態に基づくリダイレクト**:
   - `/_authenticated/route.tsx`: 認証済みユーザーのみアクセス可能なルート
   - `/_guest/route.tsx`: 未認証ユーザーのみアクセス可能なルート（ログイン・登録ページなど）

2. **認証コンテキスト**:
   - `lib/router.ts` で定義された `RouterContext` を通じて、認証状態をルート間で共有

3. **プログレスバー**:
   - ルート遷移時にNProgressを使用してローディングインジケータを表示

#### 利点

- **型安全性**: TypeScriptと統合されており、ルートパラメータやクエリパラメータが型安全
- **パフォーマンス**: 自動的にコード分割を行い、必要なコンポーネントのみを読み込む
- **開発体験**: ファイル構造がそのままURLパスに反映されるため、直感的に理解しやすい
- **保守性**: ルートごとに独立したファイルで管理されるため、大規模アプリケーションでも管理しやすい

### 技術スタック

このプロジェクトは、最新のフロントエンド技術を活用して構築されています。主要な技術スタックは以下の通りです：

#### コア技術

- **React 19**: 最新のReactバージョンを使用し、コンポーネントベースのUI開発を実現
- **TypeScript**: 静的型付けによる安全性と開発効率の向上
- **Vite**: 高速な開発サーバーとビルドツールを提供

#### ルーティングとデータフェッチング

- **TanStack Router (v1.112.0)**: ファイルベースのルーティングシステムを提供
  - 型安全なルーティング
  - ネストされたレイアウト
  - ルートごとのローディングとエラー状態
  - 開発用デバッグツール（`@tanstack/router-devtools`）

- **TanStack Query (v5.66.11)**: サーバー状態管理とデータフェッチング
  - キャッシュ管理
  - 自動再取得
  - ローディングとエラー状態の管理
  - 開発用デバッグツール（`@tanstack/react-query-devtools`）

#### 状態管理

- **Zustand (v5.0.3)**: シンプルで柔軟な状態管理ライブラリ
  - Reduxよりも少ないボイラープレートコード
  - React Hooksとの統合
  - 型安全な状態管理

#### フォーム管理

- **React Hook Form (v7.54.2)**: パフォーマンスに優れたフォーム管理ライブラリ
  - 非制御コンポーネントによる高速なレンダリング
  - バリデーション統合
  - 型安全なフォーム処理

- **Zod (v3.24.2)**: TypeScriptファーストのスキーマバリデーションライブラリ
  - 型推論
  - エラーメッセージのカスタマイズ
  - React Hook Formとの統合（`@hookform/resolvers/zod`）

#### UI/UXコンポーネント

- **Tailwind CSS (v4.0.0)**: ユーティリティファーストのCSSフレームワーク
  - カスタマイズ可能なデザインシステム
  - 高速な開発
  - 最適化されたビルド

- **Radix UI**: アクセシビリティに優れたヘッドレスUIコンポーネント
  - `@radix-ui/react-label`
  - `@radix-ui/react-slot`

- **Lucide React (v0.477.0)**: 美しいオープンソースのアイコンライブラリ

- **Sonner (v2.0.1)**: 美しいトースト通知コンポーネント

- **NProgress (v0.2.0)**: スリムなプログレスバーライブラリ

#### HTTP通信

- **Axios (v1.7.4)**: プロミスベースのHTTPクライアント
  - リクエスト/レスポンスインターセプター
  - 自動JSONパース
  - エラーハンドリング

#### 開発ツール

- **Biome (v1.9.4)**: 高速なリンターとフォーマッター
- **TypeScript (v5.8.2)**: 最新のTypeScriptバージョン
